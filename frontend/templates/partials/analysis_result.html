{% if error %}
<div class="error-alert">
    <i class="bi bi-exclamation-octagon me-2"></i>
    <strong>Analysis Failed</strong>
    <p class="mb-0 mt-2">{{ error }}</p>
</div>
{% elif report %}
<div class="card card-sentinel">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span><i class="bi bi-check-circle me-2"></i>Analysis Complete</span>
        {% set risk = report.overall_risk %}
        {% include "components/risk_badge.html" %}
    </div>
    <div class="card-body">
        <!-- Character Info -->
        <div class="d-flex align-items-center mb-4">
            <div class="flex-grow-1">
                <h4 class="mb-1">
                    <a href="/character/{{ report.character_id }}" class="character-link">
                        {{ report.character_name }}
                    </a>
                </h4>
                <small class="text-muted">ID: {{ report.character_id }}</small>
            </div>
            <div class="text-end">
                <div class="mb-1">
                    <span class="text-muted">Confidence:</span>
                    <strong>{{ (report.confidence * 100)|int }}%</strong>
                </div>
                <div class="confidence-bar" style="width: 80px;">
                    <div class="confidence-bar-fill" style="width: {{ (report.confidence * 100)|int }}%;"></div>
                </div>
            </div>
        </div>

        <!-- Flag Summary -->
        <div class="row g-2 mb-4">
            <div class="col-4 text-center">
                <div class="p-2 rounded" style="background: var(--risk-red-bg);">
                    <div class="h4 mb-0 text-danger">{{ report.red_flag_count }}</div>
                    <small class="text-muted">Red</small>
                </div>
            </div>
            <div class="col-4 text-center">
                <div class="p-2 rounded" style="background: var(--risk-yellow-bg);">
                    <div class="h4 mb-0 text-warning">{{ report.yellow_flag_count }}</div>
                    <small class="text-muted">Yellow</small>
                </div>
            </div>
            <div class="col-4 text-center">
                <div class="p-2 rounded" style="background: var(--risk-green-bg);">
                    <div class="h4 mb-0 text-success">{{ report.green_flag_count }}</div>
                    <small class="text-muted">Green</small>
                </div>
            </div>
        </div>

        <!-- Quick Flags Preview -->
        {% if report.flags %}
        <div class="mb-4">
            <h6 class="text-muted mb-3">Key Findings</h6>
            {% for flag in report.flags[:5] %}
            {% include "components/flag_card.html" %}
            {% endfor %}
            {% if report.flags|length > 5 %}
            <p class="text-muted text-center mb-0">
                <small>+ {{ report.flags|length - 5 }} more flags</small>
            </p>
            {% endif %}
        </div>
        {% endif %}

        <!-- Recommendations -->
        {% if report.recommendations %}
        <div class="mb-4">
            <h6 class="text-muted mb-3">Recommendations</h6>
            <ul class="list-unstyled mb-0">
                {% for rec in report.recommendations[:3] %}
                <li class="mb-2">
                    <i class="bi bi-chevron-right text-muted me-1"></i>{{ rec }}
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- Actions -->
        <div class="d-flex gap-2">
            <a href="/reports/{{ report.report_id }}" class="btn btn-sentinel flex-grow-1">
                <i class="bi bi-eye me-1"></i>View Full Report
            </a>
            <a href="/character/{{ report.character_id }}" class="btn btn-outline-sentinel">
                <i class="bi bi-clock-history"></i>
            </a>
        </div>
    </div>
</div>
{% else %}
<div class="card card-sentinel">
    <div class="card-body">
        <div class="empty-state">
            <i class="bi bi-question-circle"></i>
            <p class="mb-0">No result</p>
        </div>
    </div>
</div>
{% endif %}
